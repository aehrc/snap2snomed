<div class="setwidth">
  @if (processing) {
    <div>
      <app-loading-spinner></app-loading-spinner>
    </div>
  }
  <h2 mat-dialog-title>
    {{ 'BULKCHANGEDIALOG.SELECTED' | translate }}
  </h2>
  @if (isMapView) {
    <div class="alert-warning box">
      <mat-icon>warning</mat-icon>
      <div>{{'BULKCHANGEDIALOG.OWNER_WARNING' | translate}}</div>
    </div>
  }
  <br>
    @if (isDualMapView()) {
      <div class="alert-warning box">
        <mat-icon>info</mat-icon>
        <div>{{'BULKCHANGEDIALOG.RECONCILE_STATUS_INFO' | translate}}</div>
      </div>
    }
    <mat-divider class="divider"></mat-divider>
    <app-errormessage [error]="error"></app-errormessage>
    <div>
      @if (((data.task &&  data.task.type !== 'REVIEW') || data.task === null) && !clearTarget && noMapValue == null && changedStatus == null && !isDualMapView()) {
        <app-concept-search #searchComponent [scope]="data.map?.toScope || data.task?.mapping?.toScope || ''"
          [version]="data.map?.toVersion || data.task?.mapping?.toVersion || ''"
          >
          <span class="search-title">{{'BULKCHANGEDIALOG.SELECTED_TARGET' | translate}} {{currentSelection?.display || 'BULKCHANGEDIALOG.NO_SELECTED_TARGET' | translate}}</span>
        </app-concept-search>
      }
      @if (((data.task &&  data.task.type !== 'REVIEW') || data.task === null) && !clearTarget && noMapValue == null && changedStatus == null && !isDualMapView()) {
        <mat-form-field appearance="fill" class="field-full-width" id="relationships"
          >
          <mat-label>{{'TABLE.RELATIONSHIP' | translate}}</mat-label>
          <mat-select [(ngModel)]="changedRelationship" ngDefaultControl>
            <mat-option>--</mat-option>
            @for (relationship of relationships; track relationship) {
              <mat-option [value]="relationship">
                {{'RELATIONSHIP.' + relationship | translate}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      }
      <div></div>
      @if (!resetDualMap && noMapValue == null && !clearTarget && changedRelationship == null && !hasSearchValue) {
        <mat-form-field appearance="fill" class="field-full-width" id="statuses">
          <mat-label>{{'TABLE.STATUS' | translate}}</mat-label>
          <mat-select [(ngModel)]="changedStatus" ngDefaultControl>
            <mat-option>--</mat-option>
            @for (status of statuses; track status; let j = $index) {
              <mat-option [value]="status">
                {{'STATUS.' + status | translate}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      }
    </div>
    @if (noMapValue != null || clearTarget || resetDualMap) {
      <div class="alert-warning">{{'BULKCHANGEDIALOG.STATUS_AUTO' | translate}}</div>
    }
    @if (((data.task && data.task.type !== 'REVIEW') || data.task === null) && !clearTarget && changedStatus == null && changedRelationship == null && !hasSearchValue && !isDualMapView()) {
      <mat-card appearance="outlined">
        <div class="box spaced">
          <span class="box">
            <mat-checkbox color="primary"
              [(ngModel)]="clearNoMap"
            (change)="setClearNoMap($event.checked)" ngDefaultControl></mat-checkbox>
            <span>{{'BULKCHANGEDIALOG.CLEAR_NO_MAP' | translate}}</span>
          </span>
          <span class="box">
            <mat-checkbox color="primary"
              [(ngModel)]="noMap"
            (change)="setNoMap($event.checked)"></mat-checkbox>
            <span>{{'BULKCHANGEDIALOG.SET_NO_MAP' | translate}}</span>
          </span>
        </div>
        @if (noMapValue) {
          <div class="alert-danger">{{'BULKCHANGEDIALOG.NOMAP_WARNING' | translate}}</div>
        }
      </mat-card>
    }
    @if (((data.task && data.task.type !== 'REVIEW') || data.task === null) && !(noMapValue != null) && changedStatus == null && changedRelationship == null && !hasSearchValue && !isDualMapView()) {
      <mat-card appearance="outlined">
        <div class="box">
          <mat-checkbox color="primary"
            [(ngModel)]="clearTarget"
          (change)="clearTargetClicked($event.checked)" ngDefaultControl></mat-checkbox>
          <span class="auto-margin-top">{{'BULKCHANGEDIALOG.CLEAR_TARGET' | translate}}</span>
        </div>
      </mat-card>
    }
    @if (isDualMapView() && changedStatus == null) {
      <mat-card appearance="outlined">
        <div class="box">
          <mat-checkbox color="primary"
            [(ngModel)]="resetDualMap"
          ngDefaultControl></mat-checkbox>
          <span class="auto-margin-top">{{'BULKCHANGEDIALOG.REDO_DUAL_MAPPING' | translate}}</span>
        </div>
      </mat-card>
    }
    <mat-divider class="divider"></mat-divider>
    <div class="box spaced">
      <button mat-raised-button color="primary"
        [disabled]="!resetDualMap && !changedRelationship && !changedStatus && noMapValue == null && !clearTarget"
      (click)="onOk()">{{'DIALOG.OK' | translate}}</button>
      <button mat-raised-button color="any"
        [disabled]="processing"
      (click)="onCancel()">{{'DIALOG.CANCEL' | translate}}</button>
    </div>
  </div>
